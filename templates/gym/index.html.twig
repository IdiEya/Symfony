{% extends 'base.html.twig' %}

{% block title %}Gym index{% endblock %}

{% block stylesheets %}
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #faf9ff;
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: #5C406F;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            font-size: 1.8rem;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(92, 64, 111, 0.1);
            margin-bottom: 20px;
            background-color: white;
            max-width: 95%;
            margin-left: auto;
            margin-right: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 10px;
            overflow: hidden;
            font-size: 0.9rem;
        }

        .table th {
            background-color: #725387;
            color: white;
            padding: 10px 12px;
            font-weight: 500;
            text-align: center;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.3px;
        }

        .table td {
            padding: 8px 10px;
            border-bottom: 1px solid #f3edff;
            text-align: center;
            color: #555;
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .table tr:hover {
            background-color: #fbf8ff;
        }

        .btn-container {
            text-align: center;
            margin: 20px 0;
        }

        .btn-create {
            background-color: #88659F;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
            display: inline-block;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(136, 101, 159, 0.2);
        }

        .btn-create:hover {
            background-color: #9D77B8;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(136, 101, 159, 0.3);
        }

        .action-link {
            color: #725387;
            text-decoration: none;
            font-weight: 500;
            margin: 0 3px;
            padding: 3px 6px;
            border-radius: 3px;
            transition: all 0.2s ease;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .action-link:hover {
            background-color: #f3edff;
            color: #5C406F;
        }

        .btn-delete {
            color: #d32f2f;
            background-color: #ffebee;
            border: 1px solid #ef9a9a;
            padding: 3px 6px;
            border-radius: 3px;
            text-decoration: none;
            font-weight: 500;
            margin: 0 3px;
            transition: all 0.2s ease;
            font-size: 0.85rem;
            white-space: nowrap;
            display: inline-block;
            cursor: pointer;
        }

        .btn-delete:hover {
            background-color: #ffcdd2;
            color: #b71c1c;
        }

        /* Colonne Contact élargie */
        .table th:nth-child(5),
        .table td:nth-child(5) {
            width: 120px;
            min-width: 120px;
        }

        /* Popup styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(61, 38, 76, 0.8);
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            position: relative;
            box-shadow: 0 5px 25px rgba(61, 38, 76, 0.3);
            overflow: hidden;
            animation: slideDown 0.4s ease;
        }

        .close {
            position: absolute;
            right: 15px;
            top: 10px;
            font-size: 24px;
            color: #aaa;
            cursor: pointer;
            z-index: 10;
            transition: color 0.2s ease;
        }

        .close:hover {
            color: #725387;
        }

        .modal iframe {
            width: 100%;
            height: 500px;
            border: none;
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from {
                transform: translateY(-30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .table-container {
                max-width: 100%;
            }
            
            .table th, .table td {
                padding: 6px 8px;
                font-size: 0.8rem;
            }
            
            .table th:nth-child(5),
            .table td:nth-child(5) {
                width: 100px;
                min-width: 100px;
            }
            
            .btn-create {
                padding: 8px 16px;
                font-size: 0.85rem;
            }
            
            .modal-content {
                width: 95%;
                margin: 15% auto;
            }
            
            .modal iframe {
                height: 400px;
            }
        }

        /* Barre de recherche */
        .search-bar {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
        }

        .search-bar input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: 60%;
            font-size: 1rem;
        }

    </style>
{% endblock %}

{% block body %}
    <h1>Liste des salles de sport</h1>

    <!-- Barre de recherche -->
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Rechercher une salle..." onkeyup="searchTable()">
    </div>

    <div class="table-container">
        <table class="table" id="gymTable">
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Services</th>
                    <th>Horaires</th>
                    <th>Contact</th>
                    <th>Mensuel</th>
                    <th>Trimestriel</th>
                    <th>Semestriel</th>
                    <th>Annuel</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for gym in gyms %}
                <tr>
                    <td>{{ gym.nom }}</td>
                    <td>{{ gym.services }}</td>
                    <td>{{ gym.horaires }}</td>
                    <td>{{ gym.contact }}</td>
                    <td>{{ gym.prixMensuel }}</td>
                    <td>{{ gym.prixTrimestriel }}</td>
                    <td>{{ gym.prixSemestriel }}</td>
                    <td>{{ gym.prixAnnuel }}</td>
                  <td>
                    <a href="javascript:void(0);" 
                       onclick="openShowModal('{{ path('app_gym_show', {'id': gym.id}) }}')" 
                       class="action-link">Voir</a>

                    <a href="javascript:void(0);" 
                       onclick="openEditModal('{{ path('app_gym_edit', {'id': gym.id}) }}')" 
                       class="action-link">Modifier</a>

                    <a href="#" 
                       onclick="if(confirm('Êtes-vous sûr de vouloir supprimer cette salle?')) { document.getElementById('delete-form-{{ gym.id }}').submit(); }" 
                       class="action-link" >Supprimer</a>
                    
                    <form id="delete-form-{{ gym.id }}" method="post" action="{{ path('app_gym_delete', {'id': gym.id}) }}" style="display: none;">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ gym.id) }}">
                    </form>
                  </td>
                </tr>
            {% else %}
                <tr><td colspan="9">Aucun enregistrement trouvé</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="btn-container">
        <button class="btn-create" onclick="openCreateModal('{{ path('app_gym_new') }}')">+ Nouvelle salle</button>
    </div>

    <!-- Popup Modal -->
    <div id="gymModal" class="modal">
        <div class="modal-content">
            <span onclick="closeModal()" class="close">&times;</span>
            <iframe id="gymIframe" src="" width="100%" height="500px"></iframe>
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    <script>
        // Fonction de recherche de table
        function searchTable() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("searchInput");
            filter = input.value.toUpperCase();
            table = document.getElementById("gymTable");
            tr = table.getElementsByTagName("tr");

            for (i = 1; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td");
                var match = false;
                for (var j = 0; j < td.length; j++) {
                    if (td[j]) {
                        txtValue = td[j].textContent || td[j].innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            match = true;
                        }
                    }
                }
                tr[i].style.display = match ? "" : "none";
            }
        }

        // Fonction pour ouvrir le modal de création
        function openCreateModal(url) {
            const modal = document.getElementById('gymModal');
            const iframe = document.getElementById('gymIframe');
            iframe.src = url;
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        // Fonction pour ouvrir le modal de visualisation
        function openShowModal(url) {
            const modal = document.getElementById('gymModal');
            const iframe = document.getElementById('gymIframe');
            iframe.src = url;
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        // Fonction pour fermer le modal
        function closeModal() {
            const modal = document.getElementById('gymModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    </script>
{% endblock %}
