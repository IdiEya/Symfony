{% extends 'base.html.twig' %}

{% block title %}{{ gym.nom }}{% endblock %}

{% block stylesheets %}
<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        background-color: #faf9ff;
        margin: 0;
        padding: 20px;
        color: #444;
    }
    .detail-container {
        background-color: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 15px rgba(92, 64, 111, 0.1);
        max-width: 700px;
        margin: 0 auto;
    }
    h1 {
        color: #5C406F;
        margin-bottom: 15px;
        text-align: center;
        font-size: 1.6rem;
    }
    .detail-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 15px;
    }
    .map-container {
        height: 250px;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #f3edff;
        margin-bottom: 15px;
    }
    .info-item {
        display: flex;
        margin-bottom: 10px;
    }
    .info-label {
        font-weight: 500;
        color: #5C406F;
        min-width: 120px;
    }
    .action-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
    }
    .btn {
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        min-width: 100px;
        text-align: center;
        border: none;
    }
    .btn-close {
        background-color: #f3edff;
        color: #5C406F;
    }
    .btn-action {
        background: linear-gradient(135deg, #88659F, #9D77B8);
        color: white;
    }
    .btn-action:hover {
        background: linear-gradient(135deg, #9D77B8, #A882D4);
    }
    .photo-preview {
        max-width: 100%;
        max-height: 200px;
        border-radius: 8px;
        display: block;
        margin: 0 auto 15px;
    }
</style>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
{% endblock %}

{% block body %}
<div class="detail-container">
    <h1>{{ gym.nom }}</h1>

    {% if gym.photo %}
        <img src="{{ gym.photo starts with 'http' ? gym.photo : asset('uploads/gyms/' ~ gym.photo) }}" 
             alt="{{ gym.nom }}" 
             class="photo-preview"
             onerror="this.src='{{ asset('images/default-gym.jpg') }}'">
    {% else %}
        <img src="{{ asset('images/default-gym.jpg') }}" alt="Image par défaut" class="photo-preview">
    {% endif %}

    <div class="map-container" id="gymMap"></div>

    <div class="detail-grid">
        <div class="info-item">
            <span class="info-label">Coordonnées:</span>
            <span>{{ gym.latitude }}, {{ gym.longitude }}</span>
        </div>
        <div class="info-item">
            <span class="info-label">Services:</span>
            <span>{{ gym.services }}</span>
        </div>
        <div class="info-item">
            <span class="info-label">Horaires:</span>
            <span>{{ gym.horaires }}</span>
        </div>
        <div class="info-item">
            <span class="info-label">Contact:</span>
            <span>{{ gym.contact }}</span>
        </div>
        <div class="info-item">
            <span class="info-label">Prix Mensuel:</span>
            <span>{{ gym.prixMensuel }} DT</span>
        </div>
        <div class="info-item">
            <span class="info-label">Prix Trimestriel:</span>
            <span>{{ gym.prixTrimestriel }} DT</span>
        </div>
        <div class="info-item">
            <span class="info-label">Prix Semestriel:</span>
            <span>{{ gym.prixSemestriel }} DT</span>
        </div>
        <div class="info-item">
            <span class="info-label">Prix Annuel:</span>
            <span>{{ gym.prixAnnuel }} DT</span>
        </div>
    </div>

    <div class="action-buttons">
        <button onclick="window.parent.postMessage('closeModal', '*')" class="btn btn-close">
            Fermer
        </button>
       
        <form method="post" action="{{ path('app_gym_delete', {'id': gym.id}) }}" 
              onsubmit="return confirm('Confirmer la suppression ?')"
              style="display: inline;">
            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ gym.id) }}">
           
        </form>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialisation de la carte
        const lat = {{ gym.latitude ?? 0 }};
        const lng = {{ gym.longitude ?? 0 }};
        
        if (lat && lng) {
            const map = L.map('gymMap').setView([lat, lng], 15);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);
            
            L.marker([lat, lng]).addTo(map)
              .bindPopup('<b>{{ gym.nom|e('js') }}</b>')
              .openPopup();
        } else {
            document.getElementById('gymMap').style.display = 'none';
        }
    });
</script>
{% endblock %}